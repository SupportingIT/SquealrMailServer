var APP={Controller:{init:function(e){this.options=e;this.inboxUrl="/inbox/";this.tempaltes={};this.tempaltes.listItem=$("#mailListItem");this.tempaltes.mailItem=$("#mailItem");if($.cookie("squlear")){this.mail=$.cookie("squlear");this.setHeaderEmail(this.mail);this.getMails(this.mail);$(this.options.input).val(this.mail)}$(e.setemailBtn).unbind("click").bind("click",this.handleSubmit);$(e.form).submit(this.handleSubmit)},setHeaderEmail:function(e){$(".currEmail").text(" "+this.mail+"@squealr.com")},handleSubmit:function(e){var t=$(this);$("html, body").stop().animate({scrollTop:$(t.attr("href")).offset().top},1500,"easeInOutExpo");e.preventDefault();APP.Controller.getNewEmail()},getNewEmail:function(){var e=$(APP.Controller.options.input).val();if(e){e=e.split("@")[0];$.cookie("squlear",e,{expires:2,path:"/",domain:"squealr.com"});APP.Controller.mail=e;this.setHeaderEmail(e);APP.Controller.getMails(e)}return true},setMail:function(e){this.mail=e},getListItem:function(e){var t=this.tempaltes.listItem.clone().html();t=t.replace("{{$from}}",APP.Utils.formatFrom(e.from[0]));t=t.replace("{{$subject}}",e.subject);t=t.replace("{{$emailId}}",e._id);t=t.replace("{{$time}}",APP.Utils.formatDate(new Date(e.date)));return t},getMailItem:function(e){var t=this.tempaltes.mailItem.clone().html();var n=e.from[0].address+(e.from[0].name!=""?" ("+e.from[0].name+")":"");t=t.replace("{{$from}}",n);t=t.replace("{{$to}}",e.to[0].address);t=t.replace("{{$subject}}",e.subject);t=t.replace("{{$emailId}}",e._id);t=t.replace("{{$time}}",new Date(e.date));t=t.replace("{{$body}}",e.html);return t},getMails:function(e){var t=this.inboxUrl+e+"@squealr.com";$.ajax({type:"GET",url:t,dataType:"json"}).done(function(e){APP.Controller.parseMails(e)}).fail(function(e,t,n){console.warn(e,t,n)})},parseMails:function(e){APP.View.removeItem("*");if(e.length){for(var t=e.length-1;t>=0;t--){APP.View.addMailItem(this.getMailItem(e[t]));APP.View.addListItem(this.getListItem(e[t]))}}else{var n=$("#mailListNoData").clone().html();APP.View.addListItem(n)}}},View:{mailContainer:$("#mailModals"),mailListH:$(".row.dividery"),addListItem:function(e){this.mailListH.after(e)},addMailItem:function(e){this.mailContainer.append(e)},removeItem:function(e){if(e=="*"){$(".portfolio-item").parent().remove();this.mailContainer.empty();return true}$("#"+e).remove();$('a[href="#'+e+'"]').closest("div.row").remove()}},WS:{init:function(){this.socket=io();this.socket.on("add-consumer",function(){console.log("got add-consumer");APP.WS.socket.emit("add-consumer",APP.Controller.mail+"@squealr.com");console.log("sent add-consumer "+APP.Controller.mail+"@squealr.com")});this.socket.on("email",function(e){console.log(e)})}},Utils:{calcHeight:function(e){$(e).show();var t=$("html",e.contentDocument).height();console.log(t)},formatFrom:function(e){var t='<span class="addressName">'+e.address.split("@")[0]+"</span>",n='<span class="addressHost">'+"@"+e.address.split("@")[1]+"</span>";return t+n},formatDate:function(e){var t='<span class="recDate">'+e.toLocaleDateString()+"</span>",n='<span class="recTime">, '+e.toLocaleTimeString()+"</span>";return t+n}}};$(function(){APP.Controller.init({setemailBtn:".setMailBtn",input:"#emailSetInupt",form:".emailForm"})})